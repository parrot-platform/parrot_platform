<?xml version="1.0" encoding="UTF-8" ?>
<scenario name="UAC INVITE with RTP reception">
 <!-- INVITE with SDP offer -->
 <send>
  <![CDATA[
  INVITE sip:[service]@[remote_ip]:[remote_port] SIP/2.0
  Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
  From: sipp <sip:sipp@[local_ip]:[local_port]>;tag=[call_number]
  To: sut <sip:[service]@[remote_ip]:[remote_port]>
  Call-ID: [call_id]
  Cseq: 1 INVITE
  Contact: sip:sipp@[local_ip]:[local_port]
  Content-Type: application/sdp
  Content-Length: [len]

  v=0
  o=user1 53655765 2353687637 IN IP[local_ip_type] [local_ip]
  s=-
  t=0 0
  c=IN IP[media_ip_type] [media_ip]
  m=audio [media_port] RTP/AVP 0
  a=rtpmap:0 PCMU/8000
  ]]>
 </send>

 <!-- Expect 100 Trying -->
 <recv response="100" optional="true">
 </recv>

 <!-- Expect 180 Ringing (optional) -->
 <recv response="180" optional="true">
 </recv>

 <!-- Expect 200 OK with SDP answer -->
 <recv response="200">
  <action>
   <!-- Extract remote RTP port from SDP for RTP reception -->
   <ereg regexp="m=audio ([0-9]+)" search_in="msg" assign_to="remote_audio_port" />
  </action>
 </recv>

 <!-- Send ACK to complete call setup -->
 <send>
  <![CDATA[
  ACK sip:[service]@[remote_ip]:[remote_port] SIP/2.0
  Via: SIP/2.0/[transport] [local_ip]:[local_port]
  From: sipp <sip:sipp@[local_ip]:[local_port]>;tag=[call_number]
  To: sut <sip:[service]@[remote_ip]:[remote_port]>[peer_tag_param]
  Call-ID: [call_id]
  Cseq: 1 ACK
  Contact: sip:sipp@[local_ip]:[local_port]
  Content-Length: 0
  ]]>
 </send>

 <!-- Play RTP (receive audio for 5 seconds) -->
 <nop>
  <action>
   <exec play_pcap_audio="/Users/byoungdale/ElixirProjects/parrot/test/sipp/pcap/g711.pcap"/>
  </action>
 </nop>

 <!-- Wait for audio to play -->
 <pause milliseconds="5000"/>

 <!-- Send BYE to end call -->
 <send retrans="500">
  <![CDATA[
  BYE sip:[service]@[remote_ip]:[remote_port] SIP/2.0
  Via: SIP/2.0/[transport] [local_ip]:[local_port]
  From: sipp  <sip:sipp@[local_ip]:[local_port]>;tag=[call_number]
  To: sut  <sip:[service]@[remote_ip]:[remote_port]>[peer_tag_param]
  Call-ID: [call_id]
  Cseq: 2 BYE
  Contact: sip:sipp@[local_ip]:[local_port]
  Content-Length: 0
  ]]>
 </send>

 <!-- Expect 200 OK for BYE -->
 <recv response="200">
 </recv>

</scenario>